<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>footway-widget</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>

  <!-- <table>
    <thead>
      <tr>
        <td></td>
        <td colspan="5">Today</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td></td>
        <td>300</td>
        <td></td>
        <td></td>
        <td>200</td>
        <td></td>
      </tr>
      <tr>
        <td>Estimated</td>
        <td>100</td>
        <td>100</td>
        <td>100</td>
        <td>100</td>
        <td>100</td>
      </tr>
      <tr height="200">
        <td></td>
        <td></td>
        <td>20</td>
        <td>30</td>
        <td></td>
        <td>50</td>
      </tr>
      <tr>
        <td></td>
        <td>Foo</td>
        <td>Foo</td>
        <td>Foo</td>
        <td>Foo</td>
        <td>Foo</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td>Yesterday</td>
        <td>500</td>
        <td>500</td>
        <td>500</td>
        <td>500</td>
        <td>500</td>
      </tr>
    </tfoot>
  </table> -->
  <div id="container"></div>

  <script type="text/javascript" src="globe/third-party/Detector.js"></script>
  <script type="text/javascript" src="globe/third-party/three.min.js"></script>
  <script type="text/javascript" src="globe/third-party/Tween.js"></script>
  <script type="text/javascript" src="globe/globe.js"></script>
  <script type="text/javascript">

    if (!Detector.webgl) {
        Detector.addGetWebGLMessage();
    } else {
        var container = document.getElementById('container');
        var globe = new DAT.Globe(container);

        var token = 'ya29.Gl2HBYrPlcL4uG1HNQMYIN25cSVEx2FlaUzr2PEoXRhioKkv5K_4ulG3a_aoygwM_lsroDyANwqznDnLvGzsNNvdAQg4Yg0hh27i4ItXErpMp6bEt0gisfAqJooLv3k'
        // var url = 'https://www.googleapis.com/analytics/v3/data/ga?ids=ga%3A70456627&start-date=yesterday&end-date=today&metrics=ga%3Asessions&dimensions=ga%3Alatitude%2Cga%3Alongitude&access_token=' + token
        var url = 'data.json'

        var xhr = new XMLHttpRequest();
        xhr.open( 'GET', url, true );

        function getRandomColor() {
            var colors = [1.6, 1.5, 1.4, 1.05]
            return colors[Math.floor(Math.random() * colors.length)]
        }

        // What do we do when we have it?
        xhr.onreadystatechange = function() {

            // If we've received the data
            if ( xhr.readyState === 4 && xhr.status === 200 ) {

                // Parse the JSON
                var data = JSON.parse( xhr.responseText ).rows;
                var maxValue = data.map(data => data[2]).reduce((a, b) => a > b ? a : b)
                var rawdata = data
                    .map(data => [data[0], data[1], Math.sqrt(data[2]) / maxValue, getRandomColor()])
                    .reduce((a, b) => a.concat(b), []);

                // Tell the globe about your JSON data
                globe.addData(rawdata, {format: 'legend', name: 'meh'} );

                // Create the geometry
                globe.createPoints();

                // Begin animation
                globe.animate();

            }

        };

        // Begin request
        xhr.send( null );

        // Create the geometry
        globe.createPoints();

        // Begin animation
        globe.animate();
    }

  </script>
  </body>
</html>
